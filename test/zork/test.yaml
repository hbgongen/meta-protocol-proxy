admin:
  access_log_path: /tmp/admin.log
  address:
    socket_address:
      address: 127.0.0.1
      port_value: 15000
static_resources:
  listeners:
    access_log:
    - name: envoy.access_loggers.file
      typed_config:
        "@type": type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog
        path: /tmp/access_zork.log
    name: listener_meta_protocol
    address:
      socket_address:
        address: 0.0.0.0
        port_value: 20000
    filter_chains:
    - filters:
      - name: aeraki.meta_protocol_proxy
        typed_config:
          '@type': type.googleapis.com/aeraki.meta_protocol_proxy.v1alpha.MetaProtocolProxy
          application_protocol: zork
          codec:
            name: aeraki.meta_protocol.codec.zork
          metaProtocolFilters:
          - name: aeraki.meta_protocol.filters.router
          idle_timeout: 15s
          routeConfig:
            routes:
            - name: vs
              match:
                metadata:
                  - name: "market"
                    exact_match: "1"
              route:
                cluster: vs_service
                hash_policy:
                  - method
            - name: vs_compress
              match:
                metadata:
                  - name: "market"
                    exact_match: "3"
              route:
                cluster: vs_service
                hash_policy:
                    - method
            - name: vz
              match:
                metadata:
                  - name: "market"
                    exact_match: "4"
              route:
                cluster: vz_service
                hash_policy:
                    - method
            - name: vz_compress
              match:
                metadata:
                  - name: "market"
                    exact_match: "6"
              route:
                cluster: vz_service
                hash_policy:
                    - method
            - name: us
              match:
                metadata:
                  - name: "market"
                    exact_match: "5"
              route:
                cluster: us_service
                hash_policy:
                    - method
            - name: us_compress
              match:
                metadata:
                  - name: "market"
                    exact_match: "7"
              route:
                cluster: us_service
                hash_policy:
                    - method
            - name: uk
              match:
                metadata:
                  - name: "market"
                    exact_match: "8"
              route:
                cluster: uk_service
                hash_policy:
                    - method
            - name: uk_compress
              match:
                metadata:
                  - name: "market"
                    exact_match: "10"
              route:
                cluster: uk_service
                hash_policy:
                    - method
            - name: vk
              match:
                metadata:
                  - name: "market"
                    exact_match: "9"
              route:
                cluster: vk_service
                hash_policy:
                    - method
            - name: vk
              match:
                metadata:
                  - name: "market"
                    exact_match: "11"
              route:
                cluster: vk_service
                hash_policy:
                    - method      
            - name: default
              match:
                metadata:
                  - name: "market"
                    exact_match: "99"
              route:
                cluster: default_service
                hash_policy:
                    - method    
          statPrefix: zork_test

  clusters:
  - name: vs_service
    type: STATIC
    connect_timeout: 5s
    lb_policy: MAGLEV
    load_assignment:
      cluster_name: vs_service
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                address: 103.250.192.130
                port_value: 12348
      # - lb_endpoints:
      #   - endpoint:
      #       address:
      #         socket_address:
      #           address: 127.0.0.1
      #           port_value: 9989
  - name: vz_service
    type: STATIC
    connect_timeout: 5s
    lb_policy: MAGLEV
    load_assignment:
      cluster_name: vz_service
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                address: 127.0.0.1
                port_value: 9988
  - name: us_service
    type: STATIC
    connect_timeout: 5s
    lb_policy: MAGLEV
    load_assignment:
      cluster_name: us_service
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                address: 127.0.0.1
                port_value: 9989
  - name: uk_service
    type: STATIC
    connect_timeout: 5s
    lb_policy: MAGLEV
    load_assignment:
      cluster_name: uk_service
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                address: 127.0.0.1
                port_value: 20004
  - name: vk_service
    type: STATIC
    connect_timeout: 5s
    lb_policy: MAGLEV
    load_assignment:
      cluster_name: vk_service
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                address: 127.0.0.1
                port_value: 20005
  - name: default_service
    type: STATIC
    connect_timeout: 5s
    lb_policy: MAGLEV
    load_assignment:
      cluster_name: default_service
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                address: 127.0.0.1
                port_value: 20006
